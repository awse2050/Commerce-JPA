<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="~{fragment/fragment.html :: setBody(~{ :: body})}">
    <th:block th:fragment="body">


        <main class="site-main" style="margin-bottom: 100px;">
            <div class="product_image_area">
                <div class="container">
                    <div class="row s_product_inner">
                        <div class="col-lg-6">
                            <div class="owl-carousel owl-theme s_Product_carousel">
                                <div class="single-prd-item">
                                    <img class="img-fluid" src="/img/cart.jpg" width="600">
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-5 offset-lg-1">
                            <div class="s_product_text">
                                <oi>상품번호 : <span id="itemId">[[${item.itemId}]]</span></oi>
                                <h3>[[${item.itemName}]]</h3>
                                <h2>[[${item.itemAmount}]] 원</h2>
                                <ul class="list">
                                    <li><span>재고량</span> :  [[${item.stockQuantity}]] 개</a></li>
                                    <li><span>좋아요</span> :  <i class="fab fa-gratipay"></i> [[${item.likeCount}]] 개</a></li>
                                </ul>
                                <div class="product_count" style="margin-top: 24px;">
                                    <label for="qty">수량:</label>
                                    <input type="text" id="orderCount" title="수량" th:maxlength="${item.stockQuantity}" value="1" class="input-text qty">
                                </div>
                                <div>
                                    <button id="addToCart" style="display: inline-block;
                                    border-radius: 10px;
                                    border: 1px solid #384aeb;
                                    font-weight: 500;
                                    padding: 12px 20px;
                                    color: #fff; transition: all .4s ease;
                                    position: relative; background: #384aeb;" title="장바구니"> 장바구니 담기 </button>
                                    <button title="좋아요" style="border: 1px solid #e8e8e8; background: white; padding: 5px; position: relative; border-radius: 10px;">
                                        <a href="#">
                                            <i class="fab fa-gratipay" style="vertical-align: middle; font-size: 40px; color: gray;">
                                            </i>
                                        </a>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

    </th:block>
</th:block>

<script th:inline="javascript">
    window.onload = function() {

        // Button
        let addToCartBtn = document.getElementById("addToCart");

        const itemId = [[${item.itemId}]]
        var httpRequest;

        addToCartBtn.addEventListener("click", addToCart);

        function addToCart() {
            httpRequest = new XMLHttpRequest();

            var requestDao = getAddRequestDao();
            console.log(requestDao);

            httpRequest.onreadystatechange = executeResult;
            httpRequest.open("POST", "/api/cart");
            httpRequest.setRequestHeader("Content-Type", "application/json");
            httpRequest.send(JSON.stringify(requestDao));

        }

        function getAddRequestDao() {
            var dao = {
                itemId: itemId,
                orderCount: parseInt(document.getElementById("orderCount").value),
            }

            return dao;
        }

        function executeResult() {
            try {
                if(httpRequest.readyState === XMLHttpRequest.DONE) {
                    if(httpRequest.status === 200) {
                        if(confirm("성공적으로 담았습니다. 장바구니로 이동하시겠습니까?")) {
                            window.location.href = "/mycart";
                        }
                    } else {
                        alert(httpRequest.responseText);
                        return;
                    }
                }
            } catch (e) {
                alert("Caught : " + e.description);
            }
        }
    }

</script>

</body>
</html>